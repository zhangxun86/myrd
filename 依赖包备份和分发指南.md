# ä¾èµ–åŒ…å¤‡ä»½å’Œåˆ†å‘æŒ‡å—

## ğŸ“¦ ä¾èµ–åŒ…ç®¡ç†æ¦‚è¿°

æœ¬æŒ‡å—è¯¦ç»†è¯´æ˜RustDesk Androidé¡¹ç›®çš„æ‰€æœ‰ä¾èµ–åŒ…ç®¡ç†æ–¹æ¡ˆï¼Œç¡®ä¿æ–°åŒäº‹èƒ½å¤Ÿå¿«é€Ÿè·å–å’Œé…ç½®æ‰€æœ‰å¿…è¦çš„ä¾èµ–é¡¹ã€‚

---

## ğŸ¯ ä¾èµ–åŒ…åˆ†å‘æ–¹æ¡ˆ

### æ–¹æ¡ˆä¸€ï¼šGitHubä»“åº“è·å– (æ¨èâ­â­â­â­â­)
**ä»“åº“ä¿¡æ¯**:
- åœ°å€: https://github.com/zhangxun86/myrd.git
- è®¿é—®æ–¹å¼: å…¬å¼€ä»“åº“

**ä½¿ç”¨æ–¹æ³•**:
```bash
# å…‹éš†ä»“åº“
git clone https://github.com/zhangxun86/myrd.git
cd myrd

# æŒ‰ç…§æŒ‡å—å®‰è£…ç¯å¢ƒå’Œä¾èµ–
# è¯¦è§ã€Šæ–°åŒäº‹é¡¹ç›®æ¥æ‰‹å®Œæ•´æŒ‡å—.mdã€‹
```

**ä¼˜åŠ¿**:
- âœ… å§‹ç»ˆè·å–æœ€æ–°ä»£ç ç‰ˆæœ¬
- âœ… æ”¯æŒç‰ˆæœ¬æ§åˆ¶å’Œåä½œå¼€å‘
- âœ… åŒ…å«å®Œæ•´çš„æŒ‡å—æ–‡æ¡£

---

## ğŸ“‹ ä¾èµ–åŒ…è¯¦ç»†æ¸…å•

### Flutterä¾èµ–åŒ… (37ä¸ª)
**æ ¸å¿ƒæ¡†æ¶ä¾èµ–**:
```yaml
flutter: sdk
flutter_localizations: sdk
flutter_rust_bridge: "1.80.1"
ffi: ^2.1.0
```

**UIå’ŒåŠŸèƒ½ä¾èµ–**:
```yaml
provider: ^6.0.5
tuple: ^2.0.0
wakelock_plus: ^1.1.3
package_info_plus: ^4.2.0
url_launcher: ^6.3.1
toggle_switch: ^2.1.0
settings_ui: ^2.0.2
flutter_breadcrumb: ^1.0.1
http: ^1.1.0
image_picker: ^1.1.2
image: ^4.0.17
back_button_interceptor: ^6.0.1
```

**ç‰¹æ®ŠGitä¾èµ– (å…³é”®ï¼)**:
```yaml
dash_chat_2:
  git:
    url: https://github.com/rustdesk-org/Dash-Chat-2

window_manager:
  git:
    url: https://github.com/rustdesk-org/window_manager

desktop_multi_window:
  git:
    url: https://github.com/rustdesk-org/rustdesk_desktop_multi_window

uni_links:
  git:
    url: https://github.com/rustdesk-org/uni_links
    path: uni_links
    ref: f416118d843a7e9ed117c7bb7bdc2deda5a9e86f

texture_rgba_renderer:
  git:
    url: https://github.com/rustdesk-org/flutter_texture_rgba_renderer
    ref: 42797e0f03141dc2b585f76c64a13974508058b4

flutter_gpu_texture_renderer:
  git:
    url: https://github.com/rustdesk-org/flutter_gpu_texture_renderer
    ref: 08a471bb8ceccdd50483c81cdfa8b81b07b14b87

dynamic_layouts:
  git:
    url: https://github.com/rustdesk-org/dynamic_layouts.git
    ref: 24cb88413fa5181d949ddacbb30a65d5c459e7d9

window_size:
  git:
    url: https://github.com/google/flutter-desktop-embedding.git
    path: plugins/window_size
    ref: eb3964990cf19629c89ff8cb4a37640c7b3d5601
```

### Rustä¾èµ–åŒ… (Cargo.toml)
**æ ¸å¿ƒä¾èµ–**:
- `tokio` - å¼‚æ­¥è¿è¡Œæ—¶
- `serde` - åºåˆ—åŒ–/ååºåˆ—åŒ–
- `flutter_rust_bridge` - Flutteræ¡¥æ¥
- `uuid` - UUIDç”Ÿæˆ
- `anyhow` - é”™è¯¯å¤„ç†

**å¹³å°ç‰¹å®šä¾èµ–**:
- Android NDKç›¸å…³crate
- JNIæ¡¥æ¥åº“
- ç³»ç»Ÿè°ƒç”¨ç›¸å…³åº“

---

## ğŸŒ ç½‘ç»œé…ç½®å’Œé•œåƒæº

### ç¾å›½æœåŠ¡å™¨ç½‘ç»œé…ç½® (æ¨è)
**ç›´è¿é…ç½®** (æ— éœ€ä»£ç†):
```bash
# ä½¿ç”¨é»˜è®¤å®˜æ–¹æº
unset PUB_HOSTED_URL
unset FLUTTER_STORAGE_BASE_URL

# Rustä½¿ç”¨å®˜æ–¹æº
rm ~/.cargo/config.toml  # ç§»é™¤é•œåƒé…ç½®ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
```

**ä¼˜åŠ¿**: 
- âœ… ç½‘ç»œé€Ÿåº¦å¿«ï¼Œæ— éœ€ä»£ç†
- âœ… åŒ…ç‰ˆæœ¬æœ€æ–°ï¼Œå…¼å®¹æ€§å¥½
- âœ… è¿æ¥ç¨³å®šï¼Œå°‘è§è¶…æ—¶é—®é¢˜

### ä¸­å›½å¤§é™†ç½‘ç»œå¤‡ç”¨é…ç½®
**Flutteré•œåƒæº**:
```bash
export PUB_HOSTED_URL=https://pub.flutter-io.cn
export FLUTTER_STORAGE_BASE_URL=https://storage.flutter-io.cn
```

**Rusté•œåƒæºé…ç½®**:
```bash
mkdir -p ~/.cargo
cat > ~/.cargo/config.toml << 'EOF'
[source.crates-io]
registry = "https://github.com/rust-lang/crates.io-index"
replace-with = 'mirror'

[source.mirror]
registry = "https://mirrors.ustc.edu.cn/crates.io-index"
EOF
```

---

## ğŸ”§ ä¾èµ–é—®é¢˜è§£å†³æ–¹æ¡ˆ

### å¸¸è§ä¾èµ–é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ

#### 1. Flutterä¾èµ–å†²çª
**é—®é¢˜**: `version solving failed`
```bash
# è§£å†³æ–¹æ¡ˆï¼š
flutter clean
rm -rf .dart_tool/
rm pubspec.lock
flutter pub get
```

#### 2. Gitä¾èµ–è·å–å¤±è´¥
**é—®é¢˜**: `git clone failed` æˆ–ç½‘ç»œè¶…æ—¶
```bash
# è§£å†³æ–¹æ¡ˆ1ï¼šæ£€æŸ¥ç½‘ç»œè¿æ¥
ping github.com

# è§£å†³æ–¹æ¡ˆ2ï¼šä½¿ç”¨HTTPSæ›¿ä»£SSH
git config --global url."https://github.com/".insteadOf "git@github.com:"

# è§£å†³æ–¹æ¡ˆ3ï¼šå¢åŠ Gitè¶…æ—¶æ—¶é—´
git config --global http.lowSpeedLimit 0
git config --global http.lowSpeedTime 999999
```

#### 3. Rustä¾èµ–ç¼–è¯‘å¤±è´¥
**é—®é¢˜**: `failed to compile package`
```bash
# è§£å†³æ–¹æ¡ˆï¼š
cargo clean
cargo update  # æ›´æ–°ä¾èµ–ç‰ˆæœ¬
cargo build --release --target aarch64-linux-android -v  # è¯¦ç»†è¾“å‡º
```

#### 4. NDKå·¥å…·é“¾é—®é¢˜
**é—®é¢˜**: `linker not found` æˆ– `cc failed`
```bash
# è§£å†³æ–¹æ¡ˆï¼š
export NDK_HOME=$ANDROID_HOME/ndk/25.1.8937393
export PATH=$NDK_HOME/toolchains/llvm/prebuilt/linux-x86_64/bin:$PATH

# éªŒè¯å·¥å…·é“¾
$NDK_HOME/toolchains/llvm/prebuilt/linux-x86_64/bin/aarch64-linux-android33-clang --version
```

#### 5. Kotlinç¼–è¯‘ç¼“å­˜é—®é¢˜ (é‡è¦ï¼)
**é—®é¢˜**: Kotlinå¢é‡ç¼–è¯‘ç¼“å­˜å†²çª
```bash
# è§£å†³æ–¹æ¡ˆï¼ˆæŒ‰é¡¹ç›®è§„èŒƒï¼‰ï¼š
# 1. ç»ˆæ­¢æ‰€æœ‰ç›¸å…³è¿›ç¨‹
pkill -f gradle
pkill -f kotlin
pkill -f java

# 2. å®Œå…¨æ¸…ç†ç¼“å­˜
rm -rf build ~/.gradle /tmp/kotlin* /tmp/gradle*
flutter clean

# 3. é…ç½®gradle.properties
echo "kotlin.incremental=false" >> flutter/android/gradle.properties
echo "org.gradle.daemon=false" >> flutter/android/gradle.properties
echo "org.gradle.parallel=false" >> flutter/android/gradle.properties
echo "org.gradle.jvmargs=-Xmx2048m" >> flutter/android/gradle.properties
```

---

## ğŸ“Š ä¾èµ–åŒ…å¤§å°å’Œä¸‹è½½æ—¶é—´é¢„ä¼°

### Flutterä¾èµ–åŒ…
| åŒ…ç±»å‹ | æ•°é‡ | é¢„ä¼°å¤§å° | ä¸‹è½½æ—¶é—´ (ç¾å›½æœåŠ¡å™¨) |
|--------|------|----------|----------------------|
| æ ¸å¿ƒSDKåŒ… | 2 | ~50MB | 30-60ç§’ |
| ç¬¬ä¸‰æ–¹åŒ… | 25 | ~100MB | 1-2åˆ†é’Ÿ |
| Gitä¾èµ–åŒ… | 10 | ~200MB | 2-3åˆ†é’Ÿ |
| **æ€»è®¡** | **37** | **~350MB** | **3-5åˆ†é’Ÿ** |

### Rustä¾èµ–åŒ…
| åŒ…ç±»å‹ | é¢„ä¼°å¤§å° | ä¸‹è½½æ—¶é—´ (ç¾å›½æœåŠ¡å™¨) |
|--------|----------|----------------------|
| æ ¸å¿ƒcrate | ~100MB | 1-2åˆ†é’Ÿ |
| å¹³å°ç›¸å…³ | ~50MB | 30-60ç§’ |
| **æ€»è®¡** | **~150MB** | **2-3åˆ†é’Ÿ** |

### æ€»è®¡ä¾èµ–
- **æ€»ä¸‹è½½é‡**: ~500MB
- **æ€»æ—¶é—´**: 5-8åˆ†é’Ÿ (ç¾å›½æœåŠ¡å™¨ç½‘ç»œè‰¯å¥½æ—¶)
- **ç£ç›˜å ç”¨**: ~1.5GB (åŒ…å«ç¼–è¯‘ç¼“å­˜)

---

## ğŸš€ å¿«é€Ÿä¾èµ–é…ç½®è„šæœ¬

### è‡ªåŠ¨åŒ–ä¾èµ–å®‰è£…è„šæœ¬
```
#!/bin/bash
# æ–‡ä»¶å: setup_dependencies.sh

set -e  # é‡åˆ°é”™è¯¯ç«‹å³é€€å‡º

echo "ğŸš€ å¼€å§‹é…ç½®RustDesk Androidé¡¹ç›®ä¾èµ–..."

# 1. æ£€æŸ¥ç¯å¢ƒ
echo "ğŸ“‹ æ£€æŸ¥åŸºç¡€ç¯å¢ƒ..."
java -version || { echo "âŒ Javaæœªå®‰è£…"; exit 1; }
flutter --version || { echo "âŒ Flutteræœªå®‰è£…"; exit 1; }
rustc --version || { echo "âŒ Rustæœªå®‰è£…"; exit 1; }

# 2. æ¸…ç†æ—§ç¼“å­˜
echo "ğŸ§¹ æ¸…ç†æ—§ç¼“å­˜..."
flutter clean
cargo clean
rm -rf .dart_tool/

# 3. Flutterä¾èµ–
echo "ğŸ“¦ è·å–Flutterä¾èµ–..."
cd flutter
flutter pub get
cd ..

# 4. Rustä¾èµ–
echo "ğŸ¦€ æ„å»ºRustä¾èµ–..."
cargo build --release --target aarch64-linux-android

# 5. å¤åˆ¶åº“æ–‡ä»¶
echo "ğŸ“‹ å¤åˆ¶åŸç”Ÿåº“..."
mkdir -p flutter/android/app/src/main/jniLibs/arm64-v8a/
cp target/aarch64-linux-android/release/librustdesk.so flutter/android/app/src/main/jniLibs/arm64-v8a/

# 6. éªŒè¯
echo "âœ… éªŒè¯ä¾èµ–å®Œæ•´æ€§..."
ls -la target/aarch64-linux-android/release/librustdesk.so
ls -la flutter/.dart_tool/

echo "ğŸ‰ ä¾èµ–é…ç½®å®Œæˆï¼å¯ä»¥å¼€å§‹æ„å»ºAPKäº†ã€‚"
```

**ä½¿ç”¨æ–¹æ³•**:
```bash
chmod +x setup_dependencies.sh
./setup_dependencies.sh
```

---

## ğŸ”„ ä¾èµ–åŒ…ç‰ˆæœ¬ç®¡ç†

### ç‰ˆæœ¬é”å®šç­–ç•¥
**Flutterä¾èµ–ç‰ˆæœ¬é”å®š**:
- ä½¿ç”¨`pubspec.lock`æ–‡ä»¶é”å®šç²¾ç¡®ç‰ˆæœ¬
- é‡è¦ä¾èµ–ä½¿ç”¨å›ºå®šç‰ˆæœ¬å·ï¼Œå¦‚`flutter_rust_bridge: "1.80.1"`

**Rustä¾èµ–ç‰ˆæœ¬é”å®š**:
- ä½¿ç”¨`Cargo.lock`æ–‡ä»¶é”å®šç‰ˆæœ¬
- å…³é”®crateä½¿ç”¨ç²¾ç¡®ç‰ˆæœ¬æŒ‡å®š

### ç‰ˆæœ¬å‡çº§ç­–ç•¥
âš ï¸ **é‡è¦**: ä¸å»ºè®®éšæ„å‡çº§ä¾èµ–ç‰ˆæœ¬ï¼Œç‰¹åˆ«æ˜¯ä»¥ä¸‹å…³é”®ä¾èµ–ï¼š
- `flutter_rust_bridge`: å¿…é¡»ä¿æŒ1.80.1
- `ffi`: å½±å“åº•å±‚è°ƒç”¨
- Gitä¾èµ–åŒ…çš„commit hash: å·²ç»è¿‡éªŒè¯çš„ç¨³å®šç‰ˆæœ¬

---

## ğŸ“ ä¾èµ–æ”¯æŒå’Œæ•…éšœæ’é™¤

### è·å–å¸®åŠ©çš„æ¸ é“
1. **é¡¹ç›®æ–‡æ¡£**: æŸ¥çœ‹æœ¬æŒ‡å—å’Œæ¥æ‰‹æŒ‡å—
2. **æ—¥å¿—åˆ†æ**: ä»”ç»†é˜…è¯»é”™è¯¯æ—¥å¿—
3. **å®˜æ–¹æ–‡æ¡£**: Flutterã€Rustå®˜æ–¹æ–‡æ¡£
4. **ç¤¾åŒºæ”¯æŒ**: GitHub Issuesã€Stack Overflow

### ä¾èµ–é—®é¢˜è¯Šæ–­æ¸…å•
é‡åˆ°ä¾èµ–é—®é¢˜æ—¶ï¼ŒæŒ‰ä»¥ä¸‹é¡ºåºæ£€æŸ¥ï¼š

- [ ] ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸
- [ ] ç¯å¢ƒå˜é‡æ˜¯å¦æ­£ç¡®è®¾ç½®
- [ ] ç£ç›˜ç©ºé—´æ˜¯å¦å……è¶³ (è‡³å°‘5GB)
- [ ] æƒé™æ˜¯å¦æ­£ç¡® (æ‰€æœ‰ç›®å½•å¯è¯»å†™)
- [ ] ç‰ˆæœ¬æ˜¯å¦åŒ¹é… (Java 17, Flutter 3.24.5ç­‰)
- [ ] ç¼“å­˜æ˜¯å¦æŸå (å°è¯•æ¸…ç†ç¼“å­˜)
- [ ] Kotlinç¼–è¯‘é…ç½®æ˜¯å¦æ­£ç¡® (æ£€æŸ¥gradle.properties)

### ç´§æ€¥æ¢å¤æ–¹æ¡ˆ
å¦‚æœä¾èµ–å®Œå…¨æŸåï¼š
1. **é‡æ–°å…‹éš†é¡¹ç›®**: ä»GitHubè·å–å…¨æ–°å‰¯æœ¬
2. **é‡æ–°å®‰è£…ç¯å¢ƒ**: æŒ‰ç…§å®Œæ•´æŒ‡å—é‡æ–°é…ç½®
3. **åˆ†æ­¥éª¤éªŒè¯**: æ¯ä¸ªç¯èŠ‚éƒ½éªŒè¯æˆåŠŸåå†ç»§ç»­

---

**æ–‡æ¡£ç‰ˆæœ¬**: v2.1  
**æœ€åæ›´æ–°**: 2024-09-14  
**ç»´æŠ¤è€…**: RustDeskå¼€å‘å›¢é˜Ÿ  
**é€‚ç”¨ç¯å¢ƒ**: LinuxæœåŠ¡å™¨ï¼Œç¾å›½ç½‘ç»œç¯å¢ƒ