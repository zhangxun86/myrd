# RustDesk Android é¡¹ç›®å®Œæ•´æ¥æ‰‹æŒ‡å—

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°
- **é¡¹ç›®åç§°**: RustDesk Androidè¿œç¨‹æ¡Œé¢åº”ç”¨
- **æ¶æ„**: Flutter + Rust æ··åˆå¼€å‘
- **ç›®æ ‡å¹³å°**: Android (arm64-v8a)
- **å½“å‰ç‰ˆæœ¬**: 1.4.2+60
- **æœåŠ¡å™¨ç¯å¢ƒ**: ç¾å›½æœåŠ¡å™¨ (æ— éœ€ä»£ç†)

## ğŸš¨ é‡è¦æé†’
> **å¿…è¯»ï¼ï¼ï¼** æœ¬æŒ‡å—åŒ…å«å®Œæ•´çš„ä»é›¶å¼€å§‹çš„ç¯å¢ƒæ­å»ºæµç¨‹ï¼Œä»»ä½•æ­¥éª¤éƒ½ä¸å¯çœç•¥ï¼
> è¯·ä¸¥æ ¼æŒ‰ç…§é¡ºåºæ‰§è¡Œï¼Œé‡åˆ°é—®é¢˜ç«‹å³åœæ­¢å¹¶æŸ¥çœ‹é—®é¢˜è§£å†³éƒ¨åˆ†ã€‚

---

## ğŸ“ 1. è·å–é¡¹ç›®ä»£ç 

### 1.1 ä»GitHubä»“åº“è·å–æœ€æ–°ä»£ç 
```bash
# å…‹éš†é¡¹ç›®ä»“åº“
git clone https://github.com/zhangxun86/myrd.git
cd myrd

# éªŒè¯é¡¹ç›®ç»“æ„
ls -la
# åº”è¯¥çœ‹åˆ°: flutter/ res/ src/ target/ Cargo.toml build.rs ç­‰ç›®å½•å’Œæ–‡ä»¶
```

### 1.2 é¡¹ç›®ç»“æ„è¯´æ˜
```
myrd/
â”œâ”€â”€ flutter/                    # Flutteråº”ç”¨ä¸»ç›®å½•
â”‚   â”œâ”€â”€ lib/                   # Dartæºä»£ç 
â”‚   â”‚   â”œâ”€â”€ generated_bridge.dart  # é‡è¦ï¼šRustæ¡¥æ¥æ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ models/            # æ•°æ®æ¨¡å‹
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”œâ”€â”€ android/               # Androidé…ç½®
â”‚   â””â”€â”€ pubspec.yaml          # Flutterä¾èµ–é…ç½®
â”œâ”€â”€ src/                       # Rustæºä»£ç 
â”œâ”€â”€ target/                    # Rustç¼–è¯‘è¾“å‡º
â”œâ”€â”€ Cargo.toml                 # Rusté¡¹ç›®é…ç½®
â””â”€â”€ build.rs                   # æ„å»ºè„šæœ¬
```

---

## âš™ï¸ 2. ç¯å¢ƒå®‰è£…é…ç½® (æå…¶é‡è¦ï¼)

### 2.1 ç³»ç»Ÿè¦æ±‚
- **æ“ä½œç³»ç»Ÿ**: CentOS 7/8 æˆ– Ubuntu 18+
- **å†…å­˜**: æœ€å°‘4GBï¼Œæ¨è8GB+
- **ç£ç›˜**: è‡³å°‘20GBå¯ç”¨ç©ºé—´
- **ç½‘ç»œ**: ç¾å›½æœåŠ¡å™¨ç¯å¢ƒï¼Œæ— éœ€ä»£ç†

### 2.2 Java 17 ç¯å¢ƒå®‰è£…
```bash
# å®‰è£…OpenJDK 17 (é‡è¦ï¼šå¿…é¡»æ˜¯17ï¼Œä¸èƒ½æ˜¯8æˆ–11)
sudo yum install -y java-17-openjdk java-17-openjdk-devel

# éªŒè¯å®‰è£…
java -version
# è¾“å‡ºåº”è¯¥åŒ…å«: openjdk version "17.x.x"

# è®¾ç½®JAVA_HOMEç¯å¢ƒå˜é‡
echo 'export JAVA_HOME=/usr/lib/jvm/java-17-openjdk' >> ~/.bashrc
echo 'export PATH=$JAVA_HOME/bin:$PATH' >> ~/.bashrc
source ~/.bashrc

# éªŒè¯ç¯å¢ƒå˜é‡
echo $JAVA_HOME
# åº”è¯¥è¾“å‡º: /usr/lib/jvm/java-17-openjdk
```

### 2.3 Android SDK å®‰è£…
```bash
# åˆ›å»ºAndroid SDKç›®å½•
mkdir -p /root/android-sdk
cd /root/android-sdk

# ä¸‹è½½Androidå‘½ä»¤è¡Œå·¥å…·
wget https://dl.google.com/android/repository/commandlinetools-linux-11076708_latest.zip
unzip commandlinetools-linux-11076708_latest.zip
mkdir -p cmdline-tools/latest
mv cmdline-tools/* cmdline-tools/latest/ 2>/dev/null || true

# è®¾ç½®Androidç¯å¢ƒå˜é‡
echo 'export ANDROID_HOME=/root/android-sdk' >> ~/.bashrc
echo 'export PATH=$ANDROID_HOME/cmdline-tools/latest/bin:$ANDROID_HOME/platform-tools:$PATH' >> ~/.bashrc
source ~/.bashrc

# å®‰è£…å¿…è¦çš„Androidç»„ä»¶
sdkmanager --install "platform-tools"
sdkmanager --install "platforms;android-33"
sdkmanager --install "build-tools;33.0.2"
sdkmanager --install "ndk;25.1.8937393"

# éªŒè¯å®‰è£…
adb --version
# åº”è¯¥æ˜¾ç¤ºAndroid Debug Bridgeç‰ˆæœ¬ä¿¡æ¯
```

### 2.4 Flutter 3.24.5 å®‰è£…
```bash
# ä¸‹è½½Flutter 3.24.5
cd /root
wget https://storage.googleapis.com/flutter_infra_release/releases/stable/linux/flutter_linux_3.24.5-stable.tar.xz
tar xf flutter_linux_3.24.5-stable.tar.xz

# è®¾ç½®Flutterç¯å¢ƒå˜é‡
echo 'export PATH=/root/flutter/bin:$PATH' >> ~/.bashrc
source ~/.bashrc

# éªŒè¯Flutterå®‰è£…
flutter --version
# åº”è¯¥æ˜¾ç¤º: Flutter 3.24.5

# é…ç½®Flutter
flutter config --no-analytics
flutter doctor --android-licenses  # æ¥å—æ‰€æœ‰è®¸å¯åè®®

# æ£€æŸ¥Flutterç¯å¢ƒ
flutter doctor
# ç¡®ä¿Androidç›¸å…³æ£€æŸ¥éƒ½é€šè¿‡
```

### 2.5 Rust ç¯å¢ƒå®‰è£…
```bash
# å®‰è£…Rust
curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh
source ~/.bashrc

# éªŒè¯Rustå®‰è£…
rustc --version
cargo --version

# æ·»åŠ Androidç›®æ ‡
rustup target add aarch64-linux-android

# éªŒè¯ç›®æ ‡å®‰è£…
rustup target list --installed | grep android
# åº”è¯¥çœ‹åˆ°: aarch64-linux-android
```

---

## ğŸ“¦ 3. ä¾èµ–åŒ…ç®¡ç† (æ ¸å¿ƒé‡ç‚¹ï¼)

### 3.1 Flutterä¾èµ–é…ç½®
```bash
cd myrd/flutter

# æ¸…ç†ç¼“å­˜
flutter clean
rm -rf .dart_tool/
rm -rf build/

# è·å–Flutterä¾èµ–
flutter pub get

# å¦‚æœé‡åˆ°ç½‘ç»œé—®é¢˜ï¼Œè®¾ç½®é•œåƒï¼š
export PUB_HOSTED_URL=https://pub.flutter-io.cn
export FLUTTER_STORAGE_BASE_URL=https://storage.flutter-io.cn
flutter pub get
```

### 3.2 Rustä¾èµ–é…ç½®
```bash
cd myrd

# æ¸…ç†Rustç¼“å­˜
cargo clean

# æ„å»ºRustä¾èµ–
cargo build --release --target aarch64-linux-android

# å¦‚æœé‡åˆ°ç½‘ç»œé—®é¢˜ï¼Œé…ç½®Rusté•œåƒï¼š
mkdir -p ~/.cargo
cat > ~/.cargo/config.toml << 'EOF'
[source.crates-io]
registry = "https://github.com/rust-lang/crates.io-index"
replace-with = 'mirror'

[source.mirror]
registry = "https://mirrors.ustc.edu.cn/crates.io-index"
EOF
```

---

## ğŸ”¨ 4. æ„å»ºæµç¨‹

### 4.1 é¢„æ„å»ºæ£€æŸ¥
```bash
cd myrd/flutter

# ç¯å¢ƒæ£€æŸ¥
flutter doctor -v
# ç¡®ä¿æ‰€æœ‰æ£€æŸ¥éƒ½é€šè¿‡

# é¡¹ç›®é…ç½®æ£€æŸ¥
flutter analyze
# åº”è¯¥æ²¡æœ‰ä¸¥é‡é”™è¯¯

# ä¾èµ–æ£€æŸ¥
flutter pub deps
# ç¡®è®¤æ‰€æœ‰ä¾èµ–éƒ½æ­£ç¡®è§£æ
```

### 4.2 Ruståº“ç¼–è¯‘
```bash
cd myrd

# æ¸…ç†ä¹‹å‰çš„æ„å»º
cargo clean

# ç¼–è¯‘Ruståº“
cargo build --release --target aarch64-linux-android

# éªŒè¯ç¼–è¯‘ç»“æœ
ls -la target/aarch64-linux-android/release/librustdesk.so
# æ–‡ä»¶åº”è¯¥å­˜åœ¨ä¸”å¤§å°çº¦400-500KB

# å¤åˆ¶åˆ°Flutteré¡¹ç›®
mkdir -p flutter/android/app/src/main/jniLibs/arm64-v8a/
cp target/aarch64-linux-android/release/librustdesk.so flutter/android/app/src/main/jniLibs/arm64-v8a/
```

### 4.3 Flutter APKæ„å»º
```bash
cd myrd/flutter

# æ¸…ç†Flutterç¼“å­˜
flutter clean
flutter pub get

# æ„å»ºAPK (ä½¿ç”¨é¡¹ç›®è®°å¿†ä¸­çš„å…·ä½“å‘½ä»¤)
export PATH="/root/flutter/bin:$PATH"
flutter build apk --release --no-shrink --build-name=1.4.2 --build-number=60

# éªŒè¯APK
ls -la build/app/outputs/flutter-apk/
# åº”è¯¥çœ‹åˆ°ç”Ÿæˆçš„APKæ–‡ä»¶
```

---

## âš ï¸ 5. å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ

### 5.1 Javaç‰ˆæœ¬é—®é¢˜
**é—®é¢˜**: `Unsupported Java version` æˆ–ç‰ˆæœ¬å†²çª
```bash
# è§£å†³æ–¹æ¡ˆï¼šåˆ‡æ¢åˆ°Java 17
sudo alternatives --config java  # é€‰æ‹©Java 17
export JAVA_HOME=/usr/lib/jvm/java-17-openjdk
java -version  # éªŒè¯ç‰ˆæœ¬
```

### 5.2 Flutterä¾èµ–é—®é¢˜
**é—®é¢˜**: `pub get failed` æˆ–ä¾èµ–è§£æé”™è¯¯
```bash
# è§£å†³æ–¹æ¡ˆï¼š
flutter clean
rm -rf ~/.pub-cache/  # æ¸…ç†å…¨å±€ç¼“å­˜
rm -rf .dart_tool/
flutter pub cache repair  # ä¿®å¤ç¼“å­˜
flutter pub get
```

### 5.3 Kotlinç¼–è¯‘é—®é¢˜
**é—®é¢˜**: Kotlinç¼“å­˜å†²çªæˆ–ç¼–è¯‘é”™è¯¯
```bash
# è§£å†³æ–¹æ¡ˆï¼ˆæŒ‰å†…å­˜çŸ¥è¯†ï¼‰ï¼š
# 1. ç»ˆæ­¢æ‰€æœ‰ç›¸å…³è¿›ç¨‹
pkill -f gradle
pkill -f kotlin
pkill -f java

# 2. å®Œå…¨æ¸…ç†ç¼“å­˜
rm -rf build ~/.gradle /tmp/kotlin* /tmp/gradle*
flutter clean

# 3. ç¦ç”¨Kotlinå¢é‡ç¼–è¯‘ - åœ¨gradle.propertiesä¸­æ·»åŠ 
echo "kotlin.incremental=false" >> flutter/android/gradle.properties
echo "org.gradle.daemon=false" >> flutter/android/gradle.properties
echo "org.gradle.parallel=false" >> flutter/android/gradle.properties

# 4. å¢åŠ å†…å­˜åˆ†é…
echo "org.gradle.jvmargs=-Xmx2048m" >> flutter/android/gradle.properties
```

### 5.4 Androidè®¸å¯åè®®é—®é¢˜
```bash
# è§£å†³æ–¹æ¡ˆï¼š
flutter doctor --android-licenses
# è¾“å…¥ 'y' æ¥å—æ‰€æœ‰è®¸å¯åè®®
```

### 5.5 Rustç¼–è¯‘é”™è¯¯
```bash
# è§£å†³æ–¹æ¡ˆï¼šå®‰è£…å¿…è¦çš„æ„å»ºå·¥å…·
yum install -y gcc gcc-c++ make

# è®¾ç½®NDKè·¯å¾„
export NDK_HOME=$ANDROID_HOME/ndk/25.1.8937393
export PATH=$NDK_HOME/toolchains/llvm/prebuilt/linux-x86_64/bin:$PATH
```

---

## ğŸ” 6. é‡è¦æ–‡ä»¶è¯¦è§£

### 6.1 generated_bridge.dart
- **ä½ç½®**: `flutter/lib/generated_bridge.dart`
- **ä½œç”¨**: Flutterä¸Rustçš„æ¡¥æ¥æ–‡ä»¶
- **é‡è¦æ€§**: â­â­â­â­â­ **ç»å¯¹ä¸å¯ä¿®æ”¹ï¼** å·²è§£å†³PlatformFFIå†²çªé—®é¢˜

### 6.2 pubspec.yaml
- **ä½ç½®**: `flutter/pubspec.yaml`
- **ä½œç”¨**: Flutteré¡¹ç›®ä¾èµ–é…ç½®
- **å…³é”®ä¾èµ–**: 
  - `flutter_rust_bridge: "1.80.1"`
  - `ffi: ^2.1.0`

---

## ğŸ“Š 7. æ„å»ºéªŒè¯

### 7.1 æ„å»ºæˆåŠŸæ ‡å¿—
```bash
# Ruståº“ç¼–è¯‘æˆåŠŸ
ls -la target/aarch64-linux-android/release/librustdesk.so
# æ–‡ä»¶å¤§å°åº”è¯¥åœ¨400-500KB

# Flutter APKæ„å»ºæˆåŠŸ
ls -la flutter/build/app/outputs/flutter-apk/app-release.apk
# æ–‡ä»¶å¤§å°åº”è¯¥åœ¨50-100MB

# æ—¥å¿—ä¸­åº”è¯¥çœ‹åˆ°
# "Built build/app/outputs/flutter-apk/app-release.apk"
```

---

## ğŸ¯ 8. å¿«é€Ÿå¼€å§‹æ£€æŸ¥æ¸…å•

æ–°åŒäº‹æ¥æ‰‹é¡¹ç›®æ—¶ï¼Œè¯·æŒ‰ç…§ä»¥ä¸‹æ¸…å•é€é¡¹æ£€æŸ¥ï¼š

- [ ] 1. å…‹éš†é¡¹ç›®ä»£ç æˆåŠŸ
- [ ] 2. Java 17 å®‰è£…å¹¶è®¾ç½®ç¯å¢ƒå˜é‡
- [ ] 3. Android SDK å®‰è£…å¹¶é€šè¿‡flutter doctoræ£€æŸ¥
- [ ] 4. Flutter 3.24.5 å®‰è£…å¹¶å¯æ­£å¸¸è¿è¡Œ
- [ ] 5. Rust ç¯å¢ƒå®‰è£…å¹¶æ·»åŠ Androidç›®æ ‡
- [ ] 6. é¡¹ç›®ä¾èµ–è·å–æˆåŠŸ (flutter pub get)
- [ ] 7. Ruståº“ç¼–è¯‘æˆåŠŸ (librustdesk.soå­˜åœ¨)
- [ ] 8. Flutteråˆ†æé€šè¿‡ (flutter analyze)
- [ ] 9. APKæ„å»ºæˆåŠŸ
- [ ] 10. APKåŠŸèƒ½éªŒè¯é€šè¿‡

**æ¯ä¸€é¡¹éƒ½å¿…é¡»âœ…æ‰èƒ½è¿›è¡Œä¸‹ä¸€æ­¥ï¼**

---

## ğŸš¨ ç‰¹åˆ«æ³¨æ„äº‹é¡¹

1. **åŒ…åè§„èŒƒ**: AndroidåŒ…åå¿…é¡»ç¬¦åˆJavaæ ‡è¯†ç¬¦è§„èŒƒï¼Œä¸èƒ½åŒ…å«æ•°å­—å¼€å¤´çš„éƒ¨åˆ†
2. **Kotliné…ç½®**: å¿…é¡»ç¦ç”¨å¢é‡ç¼–è¯‘å’Œå¹¶è¡Œæ‰§è¡Œé¿å…ç¼“å­˜å†²çª
3. **å†…å­˜é…ç½®**: Gradleéœ€è¦è‡³å°‘2GBå†…å­˜è¿›è¡Œç¼–è¯‘
4. **æ–‡ä»¶æƒé™**: ç¡®ä¿æ‰€æœ‰ç›®å½•å…·æœ‰æ­£ç¡®çš„è¯»å†™æƒé™

---

æœ€åæ›´æ–°æ—¶é—´: 2024-09-14  
æ–‡æ¡£ç‰ˆæœ¬: v2.1  
ç»´æŠ¤è€…: RustDeskå¼€å‘å›¢é˜Ÿ# RustDesk Android é¡¹ç›®å®Œæ•´æ¥æ‰‹æŒ‡å—

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°
- **é¡¹ç›®åç§°**: RustDesk Androidè¿œç¨‹æ¡Œé¢åº”ç”¨
- **æ¶æ„**: Flutter + Rust æ··åˆå¼€å‘
- **ç›®æ ‡å¹³å°**: Android (arm64-v8a)
- **å½“å‰ç‰ˆæœ¬**: 1.4.2+60
- **æœåŠ¡å™¨ç¯å¢ƒ**: ç¾å›½æœåŠ¡å™¨ (æ— éœ€ä»£ç†)

## ğŸš¨ é‡è¦æé†’
> **å¿…è¯»ï¼ï¼ï¼** æœ¬æŒ‡å—åŒ…å«å®Œæ•´çš„ä»é›¶å¼€å§‹çš„ç¯å¢ƒæ­å»ºæµç¨‹ï¼Œä»»ä½•æ­¥éª¤éƒ½ä¸å¯çœç•¥ï¼
> è¯·ä¸¥æ ¼æŒ‰ç…§é¡ºåºæ‰§è¡Œï¼Œé‡åˆ°é—®é¢˜ç«‹å³åœæ­¢å¹¶æŸ¥çœ‹é—®é¢˜è§£å†³éƒ¨åˆ†ã€‚

---

## ğŸ“ 1. è·å–é¡¹ç›®ä»£ç 

### 1.1 ä»GitHubä»“åº“è·å–æœ€æ–°ä»£ç 
```bash
# å…‹éš†é¡¹ç›®ä»“åº“
git clone https://github.com/zhangxun86/myrd.git
cd myrd

# éªŒè¯é¡¹ç›®ç»“æ„
ls -la
# åº”è¯¥çœ‹åˆ°: flutter/ res/ src/ target/ Cargo.toml build.rs ç­‰ç›®å½•å’Œæ–‡ä»¶
```

### 1.2 é¡¹ç›®ç»“æ„è¯´æ˜
```
myrd/
â”œâ”€â”€ flutter/                    # Flutteråº”ç”¨ä¸»ç›®å½•
â”‚   â”œâ”€â”€ lib/                   # Dartæºä»£ç 
â”‚   â”‚   â”œâ”€â”€ generated_bridge.dart  # é‡è¦ï¼šRustæ¡¥æ¥æ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ models/            # æ•°æ®æ¨¡å‹
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”œâ”€â”€ android/               # Androidé…ç½®
â”‚   â””â”€â”€ pubspec.yaml          # Flutterä¾èµ–é…ç½®
â”œâ”€â”€ src/                       # Rustæºä»£ç 
â”œâ”€â”€ target/                    # Rustç¼–è¯‘è¾“å‡º
â”œâ”€â”€ Cargo.toml                 # Rusté¡¹ç›®é…ç½®
â””â”€â”€ build.rs                   # æ„å»ºè„šæœ¬
```

---

## âš™ï¸ 2. ç¯å¢ƒå®‰è£…é…ç½® (æå…¶é‡è¦ï¼)

### 2.1 ç³»ç»Ÿè¦æ±‚
- **æ“ä½œç³»ç»Ÿ**: CentOS 7/8 æˆ– Ubuntu 18+
- **å†…å­˜**: æœ€å°‘4GBï¼Œæ¨è8GB+
- **ç£ç›˜**: è‡³å°‘20GBå¯ç”¨ç©ºé—´
- **ç½‘ç»œ**: ç¾å›½æœåŠ¡å™¨ç¯å¢ƒï¼Œæ— éœ€ä»£ç†

### 2.2 Java 17 ç¯å¢ƒå®‰è£…
```bash
# å®‰è£…OpenJDK 17 (é‡è¦ï¼šå¿…é¡»æ˜¯17ï¼Œä¸èƒ½æ˜¯8æˆ–11)
sudo yum install -y java-17-openjdk java-17-openjdk-devel

# éªŒè¯å®‰è£…
java -version
# è¾“å‡ºåº”è¯¥åŒ…å«: openjdk version "17.x.x"

# è®¾ç½®JAVA_HOMEç¯å¢ƒå˜é‡
echo 'export JAVA_HOME=/usr/lib/jvm/java-17-openjdk' >> ~/.bashrc
echo 'export PATH=$JAVA_HOME/bin:$PATH' >> ~/.bashrc
source ~/.bashrc

# éªŒè¯ç¯å¢ƒå˜é‡
echo $JAVA_HOME
# åº”è¯¥è¾“å‡º: /usr/lib/jvm/java-17-openjdk
```

### 2.3 Android SDK å®‰è£…
```bash
# åˆ›å»ºAndroid SDKç›®å½•
mkdir -p /root/android-sdk
cd /root/android-sdk

# ä¸‹è½½Androidå‘½ä»¤è¡Œå·¥å…·
wget https://dl.google.com/android/repository/commandlinetools-linux-11076708_latest.zip
unzip commandlinetools-linux-11076708_latest.zip
mkdir -p cmdline-tools/latest
mv cmdline-tools/* cmdline-tools/latest/ 2>/dev/null || true

# è®¾ç½®Androidç¯å¢ƒå˜é‡
echo 'export ANDROID_HOME=/root/android-sdk' >> ~/.bashrc
echo 'export PATH=$ANDROID_HOME/cmdline-tools/latest/bin:$ANDROID_HOME/platform-tools:$PATH' >> ~/.bashrc
source ~/.bashrc

# å®‰è£…å¿…è¦çš„Androidç»„ä»¶
sdkmanager --install "platform-tools"
sdkmanager --install "platforms;android-33"
sdkmanager --install "build-tools;33.0.2"
sdkmanager --install "ndk;25.1.8937393"

# éªŒè¯å®‰è£…
adb --version
# åº”è¯¥æ˜¾ç¤ºAndroid Debug Bridgeç‰ˆæœ¬ä¿¡æ¯
```

### 2.4 Flutter 3.24.5 å®‰è£…
```bash
# ä¸‹è½½Flutter 3.24.5
cd /root
wget https://storage.googleapis.com/flutter_infra_release/releases/stable/linux/flutter_linux_3.24.5-stable.tar.xz
tar xf flutter_linux_3.24.5-stable.tar.xz

# è®¾ç½®Flutterç¯å¢ƒå˜é‡
echo 'export PATH=/root/flutter/bin:$PATH' >> ~/.bashrc
source ~/.bashrc

# éªŒè¯Flutterå®‰è£…
flutter --version
# åº”è¯¥æ˜¾ç¤º: Flutter 3.24.5

# é…ç½®Flutter
flutter config --no-analytics
flutter doctor --android-licenses  # æ¥å—æ‰€æœ‰è®¸å¯åè®®

# æ£€æŸ¥Flutterç¯å¢ƒ
flutter doctor
# ç¡®ä¿Androidç›¸å…³æ£€æŸ¥éƒ½é€šè¿‡
```

### 2.5 Rust ç¯å¢ƒå®‰è£…
```bash
# å®‰è£…Rust
curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh
source ~/.bashrc

# éªŒè¯Rustå®‰è£…
rustc --version
cargo --version

# æ·»åŠ Androidç›®æ ‡
rustup target add aarch64-linux-android

# éªŒè¯ç›®æ ‡å®‰è£…
rustup target list --installed | grep android
# åº”è¯¥çœ‹åˆ°: aarch64-linux-android
```

---

## ğŸ“¦ 3. ä¾èµ–åŒ…ç®¡ç† (æ ¸å¿ƒé‡ç‚¹ï¼)

### 3.1 Flutterä¾èµ–é…ç½®
```bash
cd myrd/flutter

# æ¸…ç†ç¼“å­˜
flutter clean
rm -rf .dart_tool/
rm -rf build/

# è·å–Flutterä¾èµ–
flutter pub get

# å¦‚æœé‡åˆ°ç½‘ç»œé—®é¢˜ï¼Œè®¾ç½®é•œåƒï¼š
export PUB_HOSTED_URL=https://pub.flutter-io.cn
export FLUTTER_STORAGE_BASE_URL=https://storage.flutter-io.cn
flutter pub get
```

### 3.2 Rustä¾èµ–é…ç½®
```bash
cd myrd

# æ¸…ç†Rustç¼“å­˜
cargo clean

# æ„å»ºRustä¾èµ–
cargo build --release --target aarch64-linux-android

# å¦‚æœé‡åˆ°ç½‘ç»œé—®é¢˜ï¼Œé…ç½®Rusté•œåƒï¼š
mkdir -p ~/.cargo
cat > ~/.cargo/config.toml << 'EOF'
[source.crates-io]
registry = "https://github.com/rust-lang/crates.io-index"
replace-with = 'mirror'

[source.mirror]
registry = "https://mirrors.ustc.edu.cn/crates.io-index"
EOF
```

---

## ğŸ”¨ 4. æ„å»ºæµç¨‹

### 4.1 é¢„æ„å»ºæ£€æŸ¥
```bash
cd myrd/flutter

# ç¯å¢ƒæ£€æŸ¥
flutter doctor -v
# ç¡®ä¿æ‰€æœ‰æ£€æŸ¥éƒ½é€šè¿‡

# é¡¹ç›®é…ç½®æ£€æŸ¥
flutter analyze
# åº”è¯¥æ²¡æœ‰ä¸¥é‡é”™è¯¯

# ä¾èµ–æ£€æŸ¥
flutter pub deps
# ç¡®è®¤æ‰€æœ‰ä¾èµ–éƒ½æ­£ç¡®è§£æ
```

### 4.2 Ruståº“ç¼–è¯‘
```bash
cd myrd

# æ¸…ç†ä¹‹å‰çš„æ„å»º
cargo clean

# ç¼–è¯‘Ruståº“
cargo build --release --target aarch64-linux-android

# éªŒè¯ç¼–è¯‘ç»“æœ
ls -la target/aarch64-linux-android/release/librustdesk.so
# æ–‡ä»¶åº”è¯¥å­˜åœ¨ä¸”å¤§å°çº¦400-500KB

# å¤åˆ¶åˆ°Flutteré¡¹ç›®
mkdir -p flutter/android/app/src/main/jniLibs/arm64-v8a/
cp target/aarch64-linux-android/release/librustdesk.so flutter/android/app/src/main/jniLibs/arm64-v8a/
```

### 4.3 Flutter APKæ„å»º
```bash
cd myrd/flutter

# æ¸…ç†Flutterç¼“å­˜
flutter clean
flutter pub get

# æ„å»ºAPK (ä½¿ç”¨é¡¹ç›®è®°å¿†ä¸­çš„å…·ä½“å‘½ä»¤)
export PATH="/root/flutter/bin:$PATH"
flutter build apk --release --no-shrink --build-name=1.4.2 --build-number=60

# éªŒè¯APK
ls -la build/app/outputs/flutter-apk/
# åº”è¯¥çœ‹åˆ°ç”Ÿæˆçš„APKæ–‡ä»¶
```

---

## âš ï¸ 5. å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ

### 5.1 Javaç‰ˆæœ¬é—®é¢˜
**é—®é¢˜**: `Unsupported Java version` æˆ–ç‰ˆæœ¬å†²çª
```bash
# è§£å†³æ–¹æ¡ˆï¼šåˆ‡æ¢åˆ°Java 17
sudo alternatives --config java  # é€‰æ‹©Java 17
export JAVA_HOME=/usr/lib/jvm/java-17-openjdk
java -version  # éªŒè¯ç‰ˆæœ¬
```

### 5.2 Flutterä¾èµ–é—®é¢˜
**é—®é¢˜**: `pub get failed` æˆ–ä¾èµ–è§£æé”™è¯¯
```bash
# è§£å†³æ–¹æ¡ˆï¼š
flutter clean
rm -rf ~/.pub-cache/  # æ¸…ç†å…¨å±€ç¼“å­˜
rm -rf .dart_tool/
flutter pub cache repair  # ä¿®å¤ç¼“å­˜
flutter pub get
```

### 5.3 Kotlinç¼–è¯‘é—®é¢˜
**é—®é¢˜**: Kotlinç¼“å­˜å†²çªæˆ–ç¼–è¯‘é”™è¯¯
```bash
# è§£å†³æ–¹æ¡ˆï¼ˆæŒ‰å†…å­˜çŸ¥è¯†ï¼‰ï¼š
# 1. ç»ˆæ­¢æ‰€æœ‰ç›¸å…³è¿›ç¨‹
pkill -f gradle
pkill -f kotlin
pkill -f java

# 2. å®Œå…¨æ¸…ç†ç¼“å­˜
rm -rf build ~/.gradle /tmp/kotlin* /tmp/gradle*
flutter clean

# 3. ç¦ç”¨Kotlinå¢é‡ç¼–è¯‘ - åœ¨gradle.propertiesä¸­æ·»åŠ 
echo "kotlin.incremental=false" >> flutter/android/gradle.properties
echo "org.gradle.daemon=false" >> flutter/android/gradle.properties
echo "org.gradle.parallel=false" >> flutter/android/gradle.properties

# 4. å¢åŠ å†…å­˜åˆ†é…
echo "org.gradle.jvmargs=-Xmx2048m" >> flutter/android/gradle.properties
```

### 5.4 Androidè®¸å¯åè®®é—®é¢˜
```bash
# è§£å†³æ–¹æ¡ˆï¼š
flutter doctor --android-licenses
# è¾“å…¥ 'y' æ¥å—æ‰€æœ‰è®¸å¯åè®®
```

### 5.5 Rustç¼–è¯‘é”™è¯¯
```bash
# è§£å†³æ–¹æ¡ˆï¼šå®‰è£…å¿…è¦çš„æ„å»ºå·¥å…·
yum install -y gcc gcc-c++ make

# è®¾ç½®NDKè·¯å¾„
export NDK_HOME=$ANDROID_HOME/ndk/25.1.8937393
export PATH=$NDK_HOME/toolchains/llvm/prebuilt/linux-x86_64/bin:$PATH
```

---

## ğŸ” 6. é‡è¦æ–‡ä»¶è¯¦è§£

### 6.1 generated_bridge.dart
- **ä½ç½®**: `flutter/lib/generated_bridge.dart`
- **ä½œç”¨**: Flutterä¸Rustçš„æ¡¥æ¥æ–‡ä»¶
- **é‡è¦æ€§**: â­â­â­â­â­ **ç»å¯¹ä¸å¯ä¿®æ”¹ï¼** å·²è§£å†³PlatformFFIå†²çªé—®é¢˜

### 6.2 pubspec.yaml
- **ä½ç½®**: `flutter/pubspec.yaml`
- **ä½œç”¨**: Flutteré¡¹ç›®ä¾èµ–é…ç½®
- **å…³é”®ä¾èµ–**: 
  - `flutter_rust_bridge: "1.80.1"`
  - `ffi: ^2.1.0`

---

## ğŸ“Š 7. æ„å»ºéªŒè¯

### 7.1 æ„å»ºæˆåŠŸæ ‡å¿—
```bash
# Ruståº“ç¼–è¯‘æˆåŠŸ
ls -la target/aarch64-linux-android/release/librustdesk.so
# æ–‡ä»¶å¤§å°åº”è¯¥åœ¨400-500KB

# Flutter APKæ„å»ºæˆåŠŸ
ls -la flutter/build/app/outputs/flutter-apk/app-release.apk
# æ–‡ä»¶å¤§å°åº”è¯¥åœ¨50-100MB

# æ—¥å¿—ä¸­åº”è¯¥çœ‹åˆ°
# "Built build/app/outputs/flutter-apk/app-release.apk"
```

---

## ğŸ¯ 8. å¿«é€Ÿå¼€å§‹æ£€æŸ¥æ¸…å•

æ–°åŒäº‹æ¥æ‰‹é¡¹ç›®æ—¶ï¼Œè¯·æŒ‰ç…§ä»¥ä¸‹æ¸…å•é€é¡¹æ£€æŸ¥ï¼š

- [ ] 1. å…‹éš†é¡¹ç›®ä»£ç æˆåŠŸ
- [ ] 2. Java 17 å®‰è£…å¹¶è®¾ç½®ç¯å¢ƒå˜é‡
- [ ] 3. Android SDK å®‰è£…å¹¶é€šè¿‡flutter doctoræ£€æŸ¥
- [ ] 4. Flutter 3.24.5 å®‰è£…å¹¶å¯æ­£å¸¸è¿è¡Œ
- [ ] 5. Rust ç¯å¢ƒå®‰è£…å¹¶æ·»åŠ Androidç›®æ ‡
- [ ] 6. é¡¹ç›®ä¾èµ–è·å–æˆåŠŸ (flutter pub get)
- [ ] 7. Ruståº“ç¼–è¯‘æˆåŠŸ (librustdesk.soå­˜åœ¨)
- [ ] 8. Flutteråˆ†æé€šè¿‡ (flutter analyze)
- [ ] 9. APKæ„å»ºæˆåŠŸ
- [ ] 10. APKåŠŸèƒ½éªŒè¯é€šè¿‡

**æ¯ä¸€é¡¹éƒ½å¿…é¡»âœ…æ‰èƒ½è¿›è¡Œä¸‹ä¸€æ­¥ï¼**

---

## ğŸš¨ ç‰¹åˆ«æ³¨æ„äº‹é¡¹

1. **åŒ…åè§„èŒƒ**: AndroidåŒ…åå¿…é¡»ç¬¦åˆJavaæ ‡è¯†ç¬¦è§„èŒƒï¼Œä¸èƒ½åŒ…å«æ•°å­—å¼€å¤´çš„éƒ¨åˆ†
2. **Kotliné…ç½®**: å¿…é¡»ç¦ç”¨å¢é‡ç¼–è¯‘å’Œå¹¶è¡Œæ‰§è¡Œé¿å…ç¼“å­˜å†²çª
3. **å†…å­˜é…ç½®**: Gradleéœ€è¦è‡³å°‘2GBå†…å­˜è¿›è¡Œç¼–è¯‘
4. **æ–‡ä»¶æƒé™**: ç¡®ä¿æ‰€æœ‰ç›®å½•å…·æœ‰æ­£ç¡®çš„è¯»å†™æƒé™

---

æœ€åæ›´æ–°æ—¶é—´: 2024-09-14  
æ–‡æ¡£ç‰ˆæœ¬: v2.1  
ç»´æŠ¤è€…: RustDeskå¼€å‘å›¢é˜Ÿ